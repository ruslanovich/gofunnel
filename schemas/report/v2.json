{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/sales-call-analysis.schema.json",
  "title": "SalesCallAnalysis",
  "type": "object",
  "additionalProperties": false,
  "required": ["meta", "passport", "deal_track", "pilot_poc", "product_track"],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_version", "source", "meeting_type", "focus_weights"],
      "properties": {
        "schema_version": { "type": "string", "pattern": "^\\d+\\.\\d+$" },
        "source": {
          "type": "object",
          "additionalProperties": false,
          "required": ["transcript_id", "transcript_format", "has_diarization", "has_timecodes", "language"],
          "properties": {
            "transcript_id": { "type": "string", "minLength": 1 },
            "transcript_format": { "type": "string", "enum": ["txt", "vtt", "other"] },
            "has_diarization": { "type": "boolean" },
            "has_timecodes": { "type": "boolean" },
            "language": { "type": "string", "minLength": 2, "maxLength": 16 }
          }
        },
        "meeting_type": {
          "type": "object",
          "additionalProperties": false,
          "required": ["primary", "secondary", "signals"],
          "properties": {
            "primary": { "$ref": "#/$defs/MeetingTypeLabelConfidence" },
            "secondary": {
              "type": "array",
              "maxItems": 2,
              "items": { "$ref": "#/$defs/MeetingTypeLabelConfidence" }
            },
            "signals": {
              "type": "array",
              "maxItems": 6,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["text", "evidence"],
                "properties": {
                  "text": { "type": "string", "minLength": 1, "maxLength": 240 },
                  "evidence": { "$ref": "#/$defs/EvidenceArray" }
                }
              }
            }
          }
        },
        "focus_weights": {
          "type": "object",
          "additionalProperties": false,
          "required": ["passport", "deal_track", "pilot_poc", "product_track"],
          "properties": {
            "passport": { "$ref": "#/$defs/Weight" },
            "deal_track": { "$ref": "#/$defs/Weight" },
            "pilot_poc": { "$ref": "#/$defs/Weight" },
            "product_track": { "$ref": "#/$defs/Weight" }
          }
        }
      }
    },

    "passport": {
      "type": "object",
      "additionalProperties": false,
      "required": ["company", "offering", "stage"],
      "properties": {
        "company": {
          "type": "object",
          "additionalProperties": false,
          "required": ["name", "group", "industry", "contacts"],
          "properties": {
            "name": { "$ref": "#/$defs/AtomicField" },
            "group": { "$ref": "#/$defs/AtomicField" },
            "industry": { "$ref": "#/$defs/AtomicField" },
            "contacts": {
              "type": "array",
              "maxItems": 6,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["person", "role"],
                "properties": {
                  "person": { "$ref": "#/$defs/AtomicField" },
                  "role": { "$ref": "#/$defs/AtomicField" }
                }
              }
            }
          }
        },
        "offering": {
          "type": "object",
          "additionalProperties": false,
          "required": ["primary_theme", "solution_candidates"],
          "properties": {
            "primary_theme": { "$ref": "#/$defs/AtomicField" },
            "solution_candidates": {
              "type": "array",
              "maxItems": 5,
              "items": { "$ref": "#/$defs/AtomicField" }
            }
          }
        },
        "stage": {
          "type": "object",
          "additionalProperties": false,
          "required": ["value", "status", "confidence", "mode", "evidence"],
          "properties": {
            "value": {
              "type": "string",
              "enum": [
                "lead",
                "discovery",
                "demo_workshop",
                "proposal",
                "negotiation",
                "procurement",
                "closed_won",
                "closed_lost"
              ]
            },
            "status": { "$ref": "#/$defs/Status" },
            "confidence": { "$ref": "#/$defs/Confidence" },
            "mode": { "type": "string", "enum": ["explicit", "inferred"] },
            "evidence": { "$ref": "#/$defs/EvidenceArray" }
          }
        }
      }
    },

    "deal_track": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "problem_impact",
        "value_hypothesis",
        "decision_people",
        "timing_trigger",
        "money_procurement",
        "momentum_next_step",
        "security_compliance_data"
      ],
      "properties": {
        "problem_impact": { "$ref": "#/$defs/ItemsAndMissingQuestions" },
        "value_hypothesis": {
          "type": "object",
          "additionalProperties": false,
          "required": ["items", "alternatives"],
          "properties": {
            "items": { "$ref": "#/$defs/AtomicItemArray" },
            "alternatives": { "$ref": "#/$defs/AtomicItemArray" }
          }
        },
        "decision_people": {
          "type": "object",
          "additionalProperties": false,
          "required": ["roles", "process"],
          "properties": {
            "roles": {
              "type": "object",
              "additionalProperties": false,
              "required": ["decision_maker", "champion", "owner", "blocker"],
              "properties": {
                "decision_maker": { "$ref": "#/$defs/AtomicField" },
                "champion": { "$ref": "#/$defs/AtomicField" },
                "owner": { "$ref": "#/$defs/AtomicField" },
                "blocker": { "$ref": "#/$defs/AtomicField" }
              }
            },
            "process": { "$ref": "#/$defs/AtomicItemArray" }
          }
        },
        "timing_trigger": {
          "type": "object",
          "additionalProperties": false,
          "required": ["items", "cadence"],
          "properties": {
            "items": { "$ref": "#/$defs/AtomicItemArray" },
            "cadence": {
              "type": "object",
              "additionalProperties": false,
              "required": ["next_contact", "deliverable"],
              "properties": {
                "next_contact": { "$ref": "#/$defs/AtomicField" },
                "deliverable": { "$ref": "#/$defs/AtomicField" }
              }
            }
          }
        },
        "money_procurement": {
          "type": "object",
          "additionalProperties": false,
          "required": ["budget", "unit_economics", "procurement", "price_sensitivity"],
          "properties": {
            "budget": { "$ref": "#/$defs/AtomicField" },
            "unit_economics": { "$ref": "#/$defs/AtomicItemArray" },
            "procurement": { "$ref": "#/$defs/AtomicItemArray" },
            "price_sensitivity": { "$ref": "#/$defs/AtomicItemArray" }
          }
        },
        "momentum_next_step": {
          "type": "object",
          "additionalProperties": false,
          "required": ["commitments", "next_step"],
          "properties": {
            "commitments": {
              "type": "array",
              "maxItems": 12,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["actor", "action", "when"],
                "properties": {
                  "actor": { "$ref": "#/$defs/ActorField" },
                  "action": { "$ref": "#/$defs/AtomicField" },
                  "when": { "$ref": "#/$defs/AtomicField" }
                }
              }
            },
            "next_step": {
              "type": "object",
              "additionalProperties": false,
              "required": ["what", "when", "goal"],
              "properties": {
                "what": { "$ref": "#/$defs/AtomicField" },
                "when": { "$ref": "#/$defs/AtomicField" },
                "goal": { "$ref": "#/$defs/AtomicField" }
              }
            }
          }
        },
        "security_compliance_data": { "$ref": "#/$defs/ItemsAndMissingQuestions" }
      }
    },

    "pilot_poc": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "status",
        "goal",
        "scope",
        "inputs_from_client",
        "outputs_from_vendor",
        "success_criteria",
        "timeline_checkpoints",
        "owners"
      ],
      "properties": {
        "status": { "$ref": "#/$defs/AtomicFieldStatusOnly" },
        "goal": { "$ref": "#/$defs/AtomicField" },
        "scope": { "$ref": "#/$defs/AtomicItemArray" },
        "inputs_from_client": { "$ref": "#/$defs/AtomicItemArray" },
        "outputs_from_vendor": { "$ref": "#/$defs/AtomicItemArray" },
        "success_criteria": { "$ref": "#/$defs/AtomicItemArray" },
        "timeline_checkpoints": { "$ref": "#/$defs/AtomicItemArray" },
        "owners": {
          "type": "object",
          "additionalProperties": false,
          "required": ["client_owner", "vendor_owner"],
          "properties": {
            "client_owner": { "$ref": "#/$defs/AtomicField" },
            "vendor_owner": { "$ref": "#/$defs/AtomicField" }
          }
        }
      }
    },

    "product_track": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "use_case",
        "requirements",
        "constraints",
        "implementation",
        "success_criteria",
        "open_questions_risks"
      ],
      "properties": {
        "use_case": { "$ref": "#/$defs/AtomicItemArrayObject" },
        "requirements": {
          "type": "object",
          "additionalProperties": false,
          "required": ["functional", "non_functional", "data_integrations"],
          "properties": {
            "functional": { "$ref": "#/$defs/AtomicItemArray" },
            "non_functional": { "$ref": "#/$defs/AtomicItemArray" },
            "data_integrations": { "$ref": "#/$defs/AtomicItemArray" }
          }
        },
        "constraints": { "$ref": "#/$defs/AtomicItemArrayObject" },
        "implementation": { "$ref": "#/$defs/AtomicItemArrayObject" },
        "success_criteria": { "$ref": "#/$defs/AtomicItemArrayObject" },
        "open_questions_risks": { "$ref": "#/$defs/AtomicItemArrayObject" }
      }
    }
  },

  "$defs": {
    "Status": { "type": "string", "enum": ["present", "missing", "not_discussed", "uncertain"] },
    "Confidence": { "type": "string", "enum": ["high", "medium", "low"] },
    "Weight": { "type": "number", "minimum": 0, "maximum": 1 },

    "MeetingTypeLabelConfidence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["label", "confidence"],
      "properties": {
        "label": {
          "type": "string",
          "enum": ["discovery", "demo_workshop", "tech_debug", "commercial", "exec_alignment"]
        },
        "confidence": { "$ref": "#/$defs/Confidence" }
      }
    },

    "Evidence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["quote"],
      "properties": {
        "quote": { "type": "string", "minLength": 1, "maxLength": 280 },
        "timecode": { "type": "string", "minLength": 4, "maxLength": 16 },
        "loc": {
          "type": "object",
          "additionalProperties": false,
          "required": ["start", "end"],
          "properties": {
            "start": { "type": "integer", "minimum": 0 },
            "end": { "type": "integer", "minimum": 0 }
          }
        },
        "source_id": { "type": "string", "minLength": 1 }
      },
      "anyOf": [
        { "required": ["timecode"] },
        { "required": ["loc"] }
      ]
    },

    "EvidenceArray": {
      "type": "array",
      "maxItems": 4,
      "items": { "$ref": "#/$defs/Evidence" }
    },

    "AtomicField": {
      "type": "object",
      "additionalProperties": false,
      "required": ["value", "status", "confidence", "evidence"],
      "properties": {
        "value": { "type": "string" },
        "status": { "$ref": "#/$defs/Status" },
        "confidence": { "$ref": "#/$defs/Confidence" },
        "evidence": { "$ref": "#/$defs/EvidenceArray" }
      }
    },

    "AtomicFieldStatusOnly": {
      "type": "object",
      "additionalProperties": false,
      "required": ["value", "status", "confidence", "evidence"],
      "properties": {
        "value": { "type": "string", "enum": ["present", "missing", "not_discussed", "uncertain"] },
        "status": { "$ref": "#/$defs/Status" },
        "confidence": { "$ref": "#/$defs/Confidence" },
        "evidence": { "$ref": "#/$defs/EvidenceArray" }
      }
    },

    "AtomicItemArray": {
      "type": "array",
      "maxItems": 12,
      "items": { "$ref": "#/$defs/AtomicField" }
    },

    "AtomicItemArrayObject": {
      "type": "object",
      "additionalProperties": false,
      "required": ["items"],
      "properties": {
        "items": { "$ref": "#/$defs/AtomicItemArray" }
      }
    },

    "ItemsAndMissingQuestions": {
      "type": "object",
      "additionalProperties": false,
      "required": ["items", "missing_questions"],
      "properties": {
        "items": { "$ref": "#/$defs/AtomicItemArray" },
        "missing_questions": {
          "type": "array",
          "maxItems": 10,
          "items": {
            "allOf": [
              { "$ref": "#/$defs/AtomicField" },
              {
                "properties": {
                  "status": { "enum": ["missing", "not_discussed"] }
                }
              }
            ]
          }
        }
      }
    },

    "ActorField": {
      "type": "object",
      "additionalProperties": false,
      "required": ["value", "status", "confidence", "evidence"],
      "properties": {
        "value": { "type": "string", "enum": ["client", "vendor", "unknown"] },
        "status": { "$ref": "#/$defs/Status" },
        "confidence": { "$ref": "#/$defs/Confidence" },
        "evidence": { "$ref": "#/$defs/EvidenceArray" }
      }
    }
  }
}


